{%- comment -%}
  Testimonial Card Snippet
  Used by testimonials.liquid for both metaobjects and blocks
  Parameters:
  - section: The section object
  - block_image
  - block_video
  - block_title
  - block_text
  - block_author_avatar
  - block_author
  - block_star_rating
  - block_verified_purchase
  - block_author_location
  - highest_ratio
  - bg_diff_class
  - content_index (for stagger animation)
  - review_handle (optional, for metaobjects)
  - block (optional, for blocks)
{%- endcomment -%}

{%- liquid
  assign spaced_image = false
  if section.settings.image_ratio == 'adapt' or section.settings.image_ratio == 'circle'
    assign spaced_image = true
  endif
  assign card_index = forloop.index
  assign card_index0 = forloop.index0
-%}

<li class="splide__slide">
  <div class="splide__slide__container" style="--index:{{ card_index0 | plus: content_index }};" {% if review_handle != blank %}data-review-handle="{{ review_handle }}"{% else %}{{ block.shopify_attributes }}{% endif %}>
    <div class="multicolumn-card content-container testimonial-card color-{{ section.settings.cards_color_scheme }} cards-color-scheme-{{ section.id }} gradient{{ bg_diff_class }} {{ section.settings.column_alignment }}{% unless block_author_avatar == blank and block_author == blank %} testimonial-card--has-author{% endunless %} animate-item animate-item--child" data-scroll-animate="scale-up" data-scroll-delay="{{ card_index | times: 100 }}">
      {%- if block_image != blank or block_video != blank -%}
        <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--{{ section.settings.image_width }}-width{% if section.settings.image_width != 'full' or spaced_image %} multicolumn-card-spacing{% endif %}">
          <div
            class="media media--transparent media--{{ section.settings.image_ratio }}"
            {% if section.settings.image_ratio == 'adapt' %}
              style="padding-bottom: {{ 1 | divided_by: highest_ratio | times: 100 }}%;"
            {% endif %}
          >
            {% if block_video == blank %}
              {%- capture sizes -%}
                (min-width: 990px) {% if section.blocks.size <= 2 %}710px{% else %}550px{% endif %}, (min-width:
                750px) {% if section.blocks.size == 1 %}710px{% else %}550px{% endif %}, calc(100vw - 30px)
              {%- endcapture -%}
              {{
                block_image
                | image_url: width: 1420
                | image_tag:
                  loading: 'lazy',
                  sizes: sizes,
                  widths: '275, 550, 710, 1420',
                  class: 'multicolumn-card__image'
              }}
            {% else %}
              <internal-video class="internal-video" data-action-on-inactive='pause'>
                {% liquid
                  assign thumbnail = block_video.preview_image
                  if block.settings != blank and block.settings.video_thumbnail != blank
                    assign thumbnail = block.settings.video_thumbnail
                  endif
                %}
                <video
                  width="100%"
                  height="auto"
                  preload='metadata'
                  poster="{{ thumbnail | image_url }}"
                  playsinline disablepictureinpicture
                >
                  {% for source in block_video.sources %}
                    <source
                      {% if block.settings != blank and block.settings.muted_autoplay %}data-{% endif %}src="{{ source.url }}"
                      type="{{ source.mime_type }}"
                    >
                  {% endfor %}
                </video>
                <button class="internal-video__play">
                  <div class="play-button color-accent-1">
                    {%- render 'icon-play' -%}
                  </div>
                </button>
                <div class='internal-video__timeline'>&nbsp</div>
              </internal-video>
            {% endif %}
          </div>
        </div>
      {%- endif -%}
      <div class="multicolumn-card__info{% if block_image == blank and section.settings.show_stars == false %} testimonial-card__info--no-image-no-stars{% endif %}{% if block_image != blank and section.settings.show_stars == false %} testimonial-card__info--image-no-stars{% endif %}">
        {%- if section.settings.show_stars -%}
          {% liquid
            assign alignment = 'center'
            if section.settings.column_alignment == 'left'
              assign alignment = 'flex-start'
            elsif section.settings.column_alignment == 'right'
              assign alignment = 'flex-end'
            endif
            assign rating = block_star_rating | default: 5
            assign visible_stars = rating | ceil
          %}
          <div class="testimonial-card__stars rating-stars rating-stars--inactive-{{ section.settings.inactive_stars_style }}" style='--rating:{{ rating }};--visible-stars:{{ visible_stars }};--star-color:{{ section.settings.star_color }};--bg-star-color:{{ section.settings.bg_star_color }};--alignment: {{ alignment }};--font-size: 1.8rem;'>
            <div class='rating-stars-and-text font-size--desktop-auto flex-center'>
              <div class='rating-stars__container rating-stars__container--underlay'>
                {%- unless section.settings.inactive_stars_style == 'hidden' -%}
                  {% if section.settings.inactive_stars_style == 'outlined' %}
                    {% for i in (1..5) %}
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill='currentColor'>
                        <path d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.6 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/>
                      </svg>
                    {% endfor %}
                  {% else %}
                    {% for i in (1..5) %}
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill='currentColor'>
                        <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/>
                      </svg>
                    {% endfor %}
                  {% endif %}
                {%- endunless -%}
                <div class='rating-stars__container rating-stars__container--overlay'>
                  {% for i in (1..5) %}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill='currentColor'>
                      <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/>
                    </svg>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        {%- endif -%}
        {%- if section.settings.show_quotes -%}
          <div class="testimonial-card__quotes flex-center{% if block_image == blank %} testimonial-card__quotes--image-blank{% endif %} color-{{ section.settings.quotes_color_scheme }}">
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
              <path fill="currentColor" d="M119.472 66.59C53.489 66.59 0 120.094 0 186.1c0 65.983 53.489 119.487 119.472 119.487c0 0-0.578 44.392-36.642 108.284c-4.006 12.802 3.135 26.435 15.945 30.418c9.089 2.859 18.653 0.08 24.829-6.389c82.925-90.7 115.385-197.448 115.385-251.8C238.989 120.094 185.501 66.59 119.472 66.59z"/>
              <path fill="currentColor" d="M392.482 66.59c-65.983 0-119.472 53.505-119.472 119.51c0 65.983 53.489 119.487 119.472 119.487c0 0-0.578 44.392-36.642 108.284c-4.006 12.802 3.136 26.435 15.945 30.418c9.089 2.859 18.653 0.08 24.828-6.389C479.539 347.2 512 240.452 512 186.1C512 120.094 458.511 66.59 392.482 66.59z"/>
            </svg>
          </div>
        {%- endif -%}
        {%- if block_title != blank -%}
          <h3>{{ block_title }}</h3>
        {%- endif -%}
        {%- if block_text != blank -%}
          <div class="rte">{{ block_text }}</div>
        {%- endif -%}
        {%- unless block_author_avatar == blank and block_author == blank -%}
          <div class="testimonial-card__author-container">
            {%- if block_author_avatar != blank -%}
              <div class="testimonial-card__avatar">
                {{
                  block_author_avatar
                  | image_url: width: 150
                  | image_tag: loading: 'lazy', width: 100
                }}
                {%- if block_verified_purchase -%}
                  <div class="testimonial-card__verified-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                  </div>
                {%- endif -%}
              </div>
            {%- endif -%}
            <div class="testimonial-card__author-info">
              {%- if block_author != blank -%}
                <p class="testimonial-card__author">
                  {{ block_author }}
                </p>
              {%- endif -%}
              {%- if block_verified_purchase -%}
                <span class="testimonial-card__verified-text">{{ section.settings.verified_badge_text | default: 'Verified Purchase' }}</span>
              {%- endif -%}
              {%- if block_author_location != blank -%}
                <span class="testimonial-card__location">{{ block_author_location }}</span>
              {%- endif -%}
            </div>
          </div>
        {%- endunless -%}
      </div>
    </div>
  </div>
</li>